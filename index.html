<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shipping Analytics Dashboard - Lazr</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue', sans-serif;
        }
        .chart-container {
            position: relative;
            height: 300px;
        }
        .chart-container-tall {
            position: relative;
            height: 500px;
        }
    </style>
</head>
<body>
    <div id="app"></div>

    <script>
        // Data from the Consolidated sheet
        const data = {
            ordersByOrigin: [
                { city: "Saint-Laurent", count: 2737 },
                { city: "Oakville", count: 2140 }
            ],
            ordersByDest: [
                { province: "QC", count: 2195 },
                { province: "ON", count: 2016 },
                { province: "NB", count: 207 },
                { province: "NL", count: 167 },
                { province: "AB", count: 161 },
                { province: "NS", count: 110 },
                { province: "SK", count: 8 },
                { province: "PE", count: 4 },
                { province: "MB", count: 4 },
                { province: "BC", count: 2 }
            ],
            routes: [
                { origin: "Saint-Laurent", dest: "QC", orders: 1959, weight: 1877288, pallets: 2721, cost: 204505.29 },
                { origin: "Oakville", dest: "ON", orders: 1616, weight: 899605, pallets: 1774, cost: 141242.93 },
                { origin: "Saint-Laurent", dest: "ON", orders: 400, weight: 910877, pallets: 818, cost: 75333.72 },
                { origin: "Oakville", dest: "QC", orders: 236, weight: 449607, pallets: 410, cost: 44477.57 },
                { origin: "Saint-Laurent", dest: "NL", orders: 111, weight: 85886, pallets: 135, cost: 28566.22 },
                { origin: "Saint-Laurent", dest: "NB", orders: 104, weight: 43689, pallets: 113, cost: 13061.76 },
                { origin: "Oakville", dest: "NB", orders: 103, weight: 56839, pallets: 118, cost: 10764.82 },
                { origin: "Saint-Laurent", dest: "AB", orders: 81, weight: 197420, pallets: 147, cost: 26218.06 },
                { origin: "Oakville", dest: "AB", orders: 80, weight: 140983, pallets: 116, cost: 27892.48 },
                { origin: "Saint-Laurent", dest: "NS", orders: 70, weight: 49954, pallets: 86, cost: 11681.14 }
            ],
            weightByOrigin: [
                { city: "Saint-Laurent", weight: 3170894 },
                { city: "Oakville", weight: 1666254 }
            ],
            weightByDest: [
                { province: "QC", weight: 2326895 },
                { province: "ON", weight: 1810517 },
                { province: "AB", weight: 338403 },
                { province: "NL", weight: 173381 },
                { province: "NB", weight: 100528 },
                { province: "NS", weight: 76487 }
            ],
            monthlyTrends: [
                { month: "2025-01", orders: 412, weight: 396967, pallets: 549, cost: 57874.12, avgCost: 140.47 },
                { month: "2025-02", orders: 383, weight: 326346, pallets: 463, cost: 51209.60, avgCost: 133.71 },
                { month: "2025-03", orders: 469, weight: 456519, pallets: 609, cost: 52882.00, avgCost: 112.75 },
                { month: "2025-04", orders: 487, weight: 635120, pallets: 765, cost: 63470.73, avgCost: 130.33 },
                { month: "2025-05", orders: 489, weight: 440746, pallets: 647, cost: 65061.54, avgCost: 133.05 },
                { month: "2025-06", orders: 416, weight: 379452, pallets: 579, cost: 47213.43, avgCost: 113.49 },
                { month: "2025-07", orders: 458, weight: 472536, pallets: 549, cost: 58398.58, avgCost: 127.51 },
                { month: "2025-08", orders: 444, weight: 636668, pallets: 678, cost: 62238.45, avgCost: 140.18 },
                { month: "2025-09", orders: 408, weight: 356319, pallets: 540, cost: 51621.31, avgCost: 126.52 },
                { month: "2025-10", orders: 424, weight: 331996, pallets: 562, cost: 46333.30, avgCost: 109.28 },
                { month: "2025-11", orders: 395, weight: 334768, pallets: 522, cost: 48746.19, avgCost: 123.41 },
                { month: "2025-12", orders: 76, weight: 61140, pallets: 108, cost: 6751.71, avgCost: 88.84 }
            ]
        };

        const COLORS = ['#3b82f6', '#10b981', '#f59e0b', '#ef4444', '#8b5cf6', '#ec4899', '#14b8a6', '#f97316'];

        let currentView = 'overview';
        let charts = {};

        function formatNumber(num) {
            if (num >= 1000000) return `${(num / 1000000).toFixed(1)}M`;
            if (num >= 1000) return `${(num / 1000).toFixed(1)}K`;
            return num.toFixed(0);
        }

        function formatCurrency(num) {
            return `$${num.toFixed(2)}`;
        }

        function formatWeight(num) {
            return `${formatNumber(num)} lbs`;
        }

        function createBarChart(canvasId, labels, dataValues, label, color) {
            const ctx = document.getElementById(canvasId);
            if (!ctx) return;
            
            if (charts[canvasId]) {
                charts[canvasId].destroy();
            }

            charts[canvasId] = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: label,
                        data: dataValues,
                        backgroundColor: color,
                        borderRadius: 8
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false }
                    },
                    scales: {
                        y: { beginAtZero: true }
                    }
                }
            });
        }

        function createHorizontalBarChart(canvasId, labels, dataValues, label, color) {
            const ctx = document.getElementById(canvasId);
            if (!ctx) return;
            
            if (charts[canvasId]) {
                charts[canvasId].destroy();
            }

            charts[canvasId] = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: label,
                        data: dataValues,
                        backgroundColor: color,
                        borderRadius: 8
                    }]
                },
                options: {
                    indexAxis: 'y',
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false }
                    },
                    scales: {
                        x: { beginAtZero: true }
                    }
                }
            });
        }

        function createPieChart(canvasId, labels, dataValues) {
            const ctx = document.getElementById(canvasId);
            if (!ctx) return;
            
            if (charts[canvasId]) {
                charts[canvasId].destroy();
            }

            charts[canvasId] = new Chart(ctx, {
                type: 'pie',
                data: {
                    labels: labels,
                    datasets: [{
                        data: dataValues,
                        backgroundColor: COLORS
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false
                }
            });
        }

        function createLineChart(canvasId, labels, datasets) {
            const ctx = document.getElementById(canvasId);
            if (!ctx) return;
            
            if (charts[canvasId]) {
                charts[canvasId].destroy();
            }

            charts[canvasId] = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: datasets
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { position: 'top' }
                    },
                    scales: {
                        y: { beginAtZero: true }
                    }
                }
            });
        }

        function showView(view) {
            currentView = view;
            render();
            
            setTimeout(() => {
                if (view === 'overview') {
                    createBarChart('chart1', data.ordersByOrigin.map(d => d.city), data.ordersByOrigin.map(d => d.count), 'Orders', '#3b82f6');
                    createBarChart('chart2', data.ordersByDest.map(d => d.province), data.ordersByDest.map(d => d.count), 'Orders', '#10b981');
                    createBarChart('chart3', data.weightByOrigin.map(d => d.city), data.weightByOrigin.map(d => d.weight), 'Weight (lbs)', '#f59e0b');
                    createBarChart('chart4', data.weightByDest.map(d => d.province), data.weightByDest.map(d => d.weight), 'Weight (lbs)', '#ef4444');
                } else if (view === 'orders') {
                    createPieChart('chart5', data.ordersByOrigin.map(d => d.city), data.ordersByOrigin.map(d => d.count));
                    createHorizontalBarChart('chart6', data.ordersByDest.map(d => d.province), data.ordersByDest.map(d => d.count), 'Orders', '#10b981');
                } else if (view === 'routes') {
                    const topRoutes = data.routes.slice(0, 15);
                    createHorizontalBarChart('chart7', topRoutes.map(r => `${r.origin} → ${r.dest}`), topRoutes.map(r => r.orders), 'Orders', '#3b82f6');
                } else if (view === 'weight') {
                    createPieChart('chart8', data.weightByOrigin.map(d => d.city), data.weightByOrigin.map(d => d.weight));
                    createHorizontalBarChart('chart9', data.weightByDest.map(d => d.province), data.weightByDest.map(d => d.weight), 'Weight (lbs)', '#f59e0b');
                } else if (view === 'trends') {
                    const months = data.monthlyTrends.map(d => d.month);
                    createLineChart('chart10', months, [{
                        label: 'Orders',
                        data: data.monthlyTrends.map(d => d.orders),
                        borderColor: '#3b82f6',
                        tension: 0.4
                    }]);
                    createLineChart('chart11', months, [
                        {
                            label: 'Weight (lbs)',
                            data: data.monthlyTrends.map(d => d.weight),
                            borderColor: '#10b981',
                            tension: 0.4,
                            yAxisID: 'y'
                        },
                        {
                            label: 'Pallets',
                            data: data.monthlyTrends.map(d => d.pallets),
                            borderColor: '#f59e0b',
                            tension: 0.4,
                            yAxisID: 'y1'
                        }
                    ]);
                    createLineChart('chart12', months, [
                        {
                            label: 'Total Cost',
                            data: data.monthlyTrends.map(d => d.cost),
                            borderColor: '#8b5cf6',
                            tension: 0.4,
                            yAxisID: 'y'
                        },
                        {
                            label: 'Avg Cost/Shipment',
                            data: data.monthlyTrends.map(d => d.avgCost),
                            borderColor: '#ec4899',
                            tension: 0.4,
                            yAxisID: 'y1'
                        }
                    ]);
                }
            }, 100);
        }

        function render() {
            const app = document.getElementById('app');
            
            const html = `
                <div class="min-h-screen bg-gradient-to-br from-slate-50 to-slate-100 p-6">
                    <div class="max-w-7xl mx-auto">
                        <!-- Header -->
                        <div class="mb-8">
                            <h1 class="text-4xl font-bold text-slate-800 mb-2">Shipping Analytics Dashboard</h1>
                            <p class="text-slate-600">Freight logistics data from Consolidated shipments (4,877 total shipments, 6,591 pallets)</p>
                            <p class="text-sm text-slate-500 mt-1">Note: Monthly trends include 4,862 shipments with valid dates.</p>
                        </div>

                        <!-- Summary Cards -->
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                            <div class="bg-white rounded-xl shadow-md p-6 border-l-4 border-blue-500">
                                <div class="text-sm text-slate-600 mb-1">Total Orders</div>
                                <div class="text-3xl font-bold text-slate-800">4,877</div>
                            </div>
                            <div class="bg-white rounded-xl shadow-md p-6 border-l-4 border-green-500">
                                <div class="text-sm text-slate-600 mb-1">Total Weight</div>
                                <div class="text-3xl font-bold text-slate-800">4.8M lbs</div>
                            </div>
                            <div class="bg-white rounded-xl shadow-md p-6 border-l-4 border-orange-500">
                                <div class="text-sm text-slate-600 mb-1">Total Pallets</div>
                                <div class="text-3xl font-bold text-slate-800">6,591</div>
                            </div>
                            <div class="bg-white rounded-xl shadow-md p-6 border-l-4 border-purple-500">
                                <div class="text-sm text-slate-600 mb-1">Avg Cost/Shipment</div>
                                <div class="text-3xl font-bold text-slate-800">$125.63</div>
                            </div>
                        </div>

                        <!-- Navigation Tabs -->
                        <div class="bg-white rounded-xl shadow-md p-2 mb-8 flex flex-wrap gap-2">
                            ${['overview', 'orders', 'routes', 'weight', 'trends'].map(view => `
                                <button 
                                    onclick="showView('${view}')"
                                    class="px-6 py-3 rounded-lg font-medium transition-all ${
                                        currentView === view
                                            ? 'bg-blue-500 text-white shadow-md'
                                            : 'bg-slate-100 text-slate-700 hover:bg-slate-200'
                                    }">
                                    ${view === 'overview' ? 'Overview' : 
                                      view === 'orders' ? 'Order Volume' :
                                      view === 'routes' ? 'Routes (Origin→Dest)' :
                                      view === 'weight' ? 'Weight Analysis' :
                                      'Monthly Trends'}
                                </button>
                            `).join('')}
                        </div>

                        <!-- Content Area -->
                        <div class="space-y-8">
                            ${currentView === 'overview' ? `
                                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                                    <div class="bg-white rounded-xl shadow-md p-6">
                                        <h2 class="text-xl font-bold text-slate-800 mb-4">Orders by Origin City</h2>
                                        <div class="chart-container"><canvas id="chart1"></canvas></div>
                                    </div>
                                    <div class="bg-white rounded-xl shadow-md p-6">
                                        <h2 class="text-xl font-bold text-slate-800 mb-4">Orders by Destination Province</h2>
                                        <div class="chart-container"><canvas id="chart2"></canvas></div>
                                    </div>
                                    <div class="bg-white rounded-xl shadow-md p-6">
                                        <h2 class="text-xl font-bold text-slate-800 mb-4">Total Weight by Origin (lbs)</h2>
                                        <div class="chart-container"><canvas id="chart3"></canvas></div>
                                    </div>
                                    <div class="bg-white rounded-xl shadow-md p-6">
                                        <h2 class="text-xl font-bold text-slate-800 mb-4">Total Weight by Destination (lbs)</h2>
                                        <div class="chart-container"><canvas id="chart4"></canvas></div>
                                    </div>
                                </div>
                            ` : ''}

                            ${currentView === 'orders' ? `
                                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                                    <div class="bg-white rounded-xl shadow-md p-6">
                                        <h2 class="text-xl font-bold text-slate-800 mb-4">Order Distribution by Origin</h2>
                                        <div class="chart-container"><canvas id="chart5"></canvas></div>
                                    </div>
                                    <div class="bg-white rounded-xl shadow-md p-6">
                                        <h2 class="text-xl font-bold text-slate-800 mb-4">Order Distribution by Destination</h2>
                                        <div class="chart-container"><canvas id="chart6"></canvas></div>
                                    </div>
                                </div>
                            ` : ''}

                            ${currentView === 'routes' ? `
                                <div class="bg-white rounded-xl shadow-md p-6">
                                    <h2 class="text-xl font-bold text-slate-800 mb-4">Top Shipping Routes (Origin → Destination)</h2>
                                    <div class="chart-container-tall"><canvas id="chart7"></canvas></div>
                                </div>
                                <div class="bg-white rounded-xl shadow-md p-6">
                                    <h2 class="text-xl font-bold text-slate-800 mb-4">All Routes - Detailed Breakdown</h2>
                                    <div class="overflow-x-auto">
                                        <table class="w-full">
                                            <thead>
                                                <tr class="border-b-2 border-slate-200">
                                                    <th class="text-left py-3 px-4 font-semibold text-slate-700">Route</th>
                                                    <th class="text-right py-3 px-4 font-semibold text-slate-700">Orders</th>
                                                    <th class="text-right py-3 px-4 font-semibold text-slate-700">Weight (lbs)</th>
                                                    <th class="text-right py-3 px-4 font-semibold text-slate-700">Pallets</th>
                                                    <th class="text-right py-3 px-4 font-semibold text-slate-700">Total Cost</th>
                                                    <th class="text-right py-3 px-4 font-semibold text-slate-700">Avg Cost/Order</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                ${data.routes.map(route => `
                                                    <tr class="border-b border-slate-100 hover:bg-slate-50">
                                                        <td class="py-3 px-4">
                                                            <span class="font-medium text-slate-800">${route.origin}</span>
                                                            <span class="text-slate-400"> → </span>
                                                            <span class="font-medium text-blue-600">${route.dest}</span>
                                                        </td>
                                                        <td class="text-right py-3 px-4 text-slate-700 font-medium">${route.orders.toLocaleString()}</td>
                                                        <td class="text-right py-3 px-4 text-slate-700">${route.weight.toLocaleString()}</td>
                                                        <td class="text-right py-3 px-4 text-slate-700">${route.pallets.toLocaleString()}</td>
                                                        <td class="text-right py-3 px-4 text-slate-700">${formatCurrency(route.cost)}</td>
                                                        <td class="text-right py-3 px-4 text-slate-700">${formatCurrency(route.cost / route.orders)}</td>
                                                    </tr>
                                                `).join('')}
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            ` : ''}

                            ${currentView === 'weight' ? `
                                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                                    <div class="bg-white rounded-xl shadow-md p-6">
                                        <h2 class="text-xl font-bold text-slate-800 mb-4">Weight Distribution by Origin (lbs)</h2>
                                        <div class="chart-container"><canvas id="chart8"></canvas></div>
                                    </div>
                                    <div class="bg-white rounded-xl shadow-md p-6">
                                        <h2 class="text-xl font-bold text-slate-800 mb-4">Weight Distribution by Destination (lbs)</h2>
                                        <div class="chart-container"><canvas id="chart9"></canvas></div>
                                    </div>
                                </div>
                            ` : ''}

                            ${currentView === 'trends' ? `
                                <div class="space-y-8">
                                    <div class="bg-white rounded-xl shadow-md p-6">
                                        <h2 class="text-xl font-bold text-slate-800 mb-4">Monthly Order Volume</h2>
                                        <div class="chart-container"><canvas id="chart10"></canvas></div>
                                    </div>
                                    <div class="bg-white rounded-xl shadow-md p-6">
                                        <h2 class="text-xl font-bold text-slate-800 mb-4">Monthly Weight & Pallet Volume</h2>
                                        <div class="chart-container"><canvas id="chart11"></canvas></div>
                                    </div>
                                    <div class="bg-white rounded-xl shadow-md p-6">
                                        <h2 class="text-xl font-bold text-slate-800 mb-4">Monthly Shipping Costs</h2>
                                        <div class="chart-container"><canvas id="chart12"></canvas></div>
                                    </div>
                                    <div class="bg-white rounded-xl shadow-md p-6">
                                        <h2 class="text-xl font-bold text-slate-800 mb-4">Monthly Breakdown</h2>
                                        <div class="overflow-x-auto">
                                            <table class="w-full">
                                                <thead>
                                                    <tr class="border-b-2 border-slate-200">
                                                        <th class="text-left py-3 px-4 font-semibold text-slate-700">Month</th>
                                                        <th class="text-right py-3 px-4 font-semibold text-slate-700">Orders</th>
                                                        <th class="text-right py-3 px-4 font-semibold text-slate-700">Weight (lbs)</th>
                                                        <th class="text-right py-3 px-4 font-semibold text-slate-700">Pallets</th>
                                                        <th class="text-right py-3 px-4 font-semibold text-slate-700">Total Cost</th>
                                                        <th class="text-right py-3 px-4 font-semibold text-slate-700">Avg Cost</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    ${data.monthlyTrends.map(row => `
                                                        <tr class="border-b border-slate-100 hover:bg-slate-50">
                                                            <td class="py-3 px-4 font-medium text-slate-800">${row.month}</td>
                                                            <td class="text-right py-3 px-4 text-slate-700">${row.orders.toLocaleString()}</td>
                                                            <td class="text-right py-3 px-4 text-slate-700">${row.weight.toLocaleString()}</td>
                                                            <td class="text-right py-3 px-4 text-slate-700">${row.pallets.toLocaleString()}</td>
                                                            <td class="text-right py-3 px-4 text-slate-700">${formatCurrency(row.cost)}</td>
                                                            <td class="text-right py-3 px-4 text-slate-700">${formatCurrency(row.avgCost)}</td>
                                                        </tr>
                                                    `).join('')}
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            ` : ''}
                        </div>
                    </div>
                </div>
            `;
            
            app.innerHTML = html;
        }

        // Initial render
        render();
        showView('overview');
    </script>
</body>
</html>
